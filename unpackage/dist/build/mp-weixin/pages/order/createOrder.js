(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{5932:function(e,t,s){},"705c":function(e,t,s){"use strict";var a=s("5932"),n=s.n(a);n.a},"9b4e":function(e,t,s){"use strict";(function(e){s("36ef");a(s("66fd"));var t=a(s("d669"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,s("543d")["createPage"])},d575:function(e,t,s){"use strict";s.r(t);var a=s("eb45"),n=s.n(a);for(var o in a)"default"!==o&&function(e){s.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},d669:function(e,t,s){"use strict";s.r(t);var a=s("e78f"),n=s("d575");for(var o in n)"default"!==o&&function(e){s.d(t,e,(function(){return n[e]}))}(o);s("705c");var i,r=s("f0c5"),d=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);t["default"]=d.exports},e78f:function(e,t,s){"use strict";var a,n=function(){var e=this,t=e.$createElement;e._self._c},o=[];s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return o})),s.d(t,"a",(function(){return a}))},eb45:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={data:function(){return{maskState:0,desc:"",payType:1,amount:1,isLive:0,sid:0,goods:{},specSelected:{size:"",color:""},couponList:[{title:"新用户专享优惠券",price:5}],addressData:{},order_sn:"",userInfo:{},share_uid:0}},onShow:function(){this.userInfo=e.getStorageSync("userInfo"),e.getStorageSync("session_key")&&this.userInfo.id||e.navigateTo({url:"/pages/public/login"})},onLoad:function(t){var s=JSON.parse(t.detail);this.specSelected={size:s.size,color:s.color},this.isLive=s.live,this.sid=s.sid,this.share_uid=s.share_uid,this.userInfo=e.getStorageSync("userInfo"),e.getStorageSync("session_key")&&this.userInfo.id?this.initData(s):e.navigateTo({url:"/pages/public/login"})},methods:{initData:function(t){var s=this;e.showLoading({title:"加载中..."}),e.request({url:this.$Url+"/clmsj/Address/get_default_address",data:{},header:{auth:e.getStorageSync("session_key")},success:function(t){0==t.data.code?s.addressData=t.data.data.address:(e.hideLoading(),e.showToast({icon:"none",title:"请先设置收货信息再进行购买"}))}}),e.request({url:this.$Url+"/clmsj/goods/goodsdetail_shop",data:{goods_id:t.goods_id,shop_id:t.sid},header:{auth:e.getStorageSync("session_key")},success:function(e){console.log(e.data.data),s.goods=e.data.data}}),e.hideLoading()},toggleMask:function(e){var t=this,s="show"===e?10:300,a="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=a}),s)},numberChange:function(e){this.number=e.number},changePayType:function(e){this.payType=e},submit:function(){var t=this;if(""==this.order_sn){if(!this.addressData.id)return e.showToast({icon:"none",title:"请先设置您的收货地址"}),!1;console.log("save order =share_uid : "+this.share_uid),e.request({url:this.$Url+"/clmsj/order/saveOrder",data:{shop_id:this.sid,goods_id:this.goods.goods_id,live:this.isLive,desc:this.desc,address_id:this.addressData.id,specSelected:this.specSelected,share_uid:this.share_uid},header:{auth:e.getStorageSync("session_key")},success:function(e){console.log("创建订单成功"),t.order_sn=e.data.data,t.payment(t.order_sn)}})}else this.payment(this.order_sn)},payment:function(t){var s=this;e.request({url:this.$Url+"/clmsj/order/getPayParam",data:{order_sn:t},header:{auth:e.getStorageSync("session_key")},success:function(t){var a=t.data.data;e.requestPayment({provider:"wxpay",timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:"MD5",paySign:a.paySign,success:function(t){e.showToast({title:"支付成功"}),s.order_sn="",e.redirectTo({url:"/pages/money/paySuccess?order_sn="+s.order_sn})},fail:function(t){console.log("fail:"+JSON.stringify(t)),e.showToast({icon:"none",title:"支付失败"})}})}})},stopPrevent:function(){}}};t.default=s}).call(this,s("543d")["default"])}},[["9b4e","common/runtime","common/vendor"]]]);